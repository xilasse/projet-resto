<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Restaurant - Administration</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <h1>üçΩÔ∏è <span class="restaurant-name">Gestion Restaurant</span> <small style="color: #666; font-size: 12px;">v2.1</small></h1>
            </div>
            <nav class="nav">
                <button id="menuTab" class="nav-btn active">Menu</button>
                <button id="tablesTab" class="nav-btn">Tables</button>
                <button id="ordersTab" class="nav-btn">Commandes</button>
                <button id="stockTab" class="nav-btn">Stock</button>
                <button id="teamTab" class="nav-btn" style="display: none;">√âquipe</button>
            </nav>
            <div class="header-right">
                <div class="restaurant-info">
                    <span class="current-restaurant" id="currentRestaurant">Chargement...</span>
                    <button id="switchRestaurantBtn" class="switch-restaurant-btn" title="Changer de restaurant" style="display: none;">üîÑ</button>
                    <button id="createRestaurantBtn" class="create-restaurant-btn" title="Cr√©er un nouveau restaurant" style="display: none;">‚ûï</button>
                </div>
                <button id="logoutBtn" class="logout-btn">D√©connexion</button>
            </div>
        </header>

        <main class="main-content">
            <!-- Section Gestion du Menu -->
            <section id="menuSection" class="section active">
                <div class="section-header">
                    <h2>üçΩÔ∏è Gestion du Menu</h2>
                    <div class="header-buttons">
                        <select id="categoryFilter" class="category-filter">
                            <option value="">Toutes les cat√©gories</option>
                            <option value="aperitif">üç∏ Ap√©ritifs</option>
                            <option value="entree">ü•ó Entr√©es</option>
                            <option value="plat">üçΩÔ∏è Plats</option>
                            <option value="dessert">üç∞ Desserts</option>
                            <option value="boisson_froide">üßä Boissons froides</option>
                            <option value="boisson_chaude">‚òï Boissons chaudes</option>
                            <option value="boisson_alcoolise">üç∑ Boissons alcoolis√©es</option>
                        </select>
                        <button id="initMenuBtn" class="btn btn-warning">üçΩÔ∏è Menu d'exemple</button>
                        <button id="addMenuItemBtn" class="btn btn-primary">Ajouter un plat</button>
                    </div>
                </div>
                <div class="menu-grid" id="menuGrid">
                    <!-- Les √©l√©ments du menu seront ajout√©s dynamiquement -->
                </div>
            </section>

            <!-- Section Gestion des Tables -->
            <section id="tablesSection" class="section">
                <div class="section-header">
                    <h2>Disposition des Tables</h2>
                    <div class="header-buttons">
                        <button id="addRoomBtn" class="btn btn-secondary">Ajouter une salle</button>
                        <button id="addTableBtn" class="btn btn-primary">Ajouter une table</button>
                        <button id="migrateTablesBtn" class="btn btn-warning">Migrer les tables</button>
                        <button id="generateAllQRBtn" class="btn btn-success">G√©n√©rer tous les QR codes</button>
                        <button id="diagnoseDatabaseBtn" class="btn btn-info">üîç Diagnostic DB</button>
                    </div>
                </div>
                <div class="rooms-container" id="roomsContainer">
                    <!-- Les salles seront affich√©es ici -->
                </div>
            </section>

            <!-- Section Commandes -->
            <section id="ordersSection" class="section">
                <div class="section-header">
                    <h2>üìã Commandes en cours</h2>
                    <div class="header-buttons">
                        <button id="refreshOrdersBtn" class="btn btn-secondary">üîÑ Actualiser</button>
                        <select id="orderStatusFilter" class="status-filter">
                            <option value="">Tous les statuts</option>
                            <option value="en_attente">En attente</option>
                            <option value="en_preparation">En pr√©paration</option>
                            <option value="pret">Pr√™t</option>
                            <option value="servi">Servi</option>
                        </select>
                    </div>
                </div>
                <div class="orders-stats">
                    <div class="stat-card">
                        <h3>En attente</h3>
                        <span id="pendingOrdersCount">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>En pr√©paration</h3>
                        <span id="preparingOrdersCount">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Pr√™ts</h3>
                        <span id="readyOrdersCount">0</span>
                    </div>
                </div>
                <div class="orders-grid" id="ordersGrid">
                    <!-- Les commandes seront affich√©es ici -->
                </div>
            </section>

            <!-- Section Stock -->
            <section id="stockSection" class="section">
                <div class="section-header">
                    <h2>üì¶ Gestion des Stocks d'Ingr√©dients</h2>
                    <div class="header-buttons">
                        <button id="addIngredientBtn" class="btn btn-primary">Ajouter un Ingr√©dient</button>
                        <button id="stockAlertBtn" class="btn btn-warning">‚ö†Ô∏è Alertes Stock</button>
                    </div>
                </div>
                <div class="stock-stats">
                    <div class="stat-card">
                        <h3>Total Ingr√©dients</h3>
                        <span id="totalIngredients">0</span>
                    </div>
                    <div class="stat-card alert">
                        <h3>Stock Faible</h3>
                        <span id="lowStockCount">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Valeur Stock</h3>
                        <span id="totalStockValue">0‚Ç¨</span>
                    </div>
                </div>
                <div class="stock-grid" id="stockGrid">
                    <!-- Le stock sera affich√© ici -->
                </div>
            </section>

            <!-- Section Gestion d'√âquipe -->
            <section id="teamSection" class="section">
                <div class="section-header">
                    <h2>üë• Gestion d'√âquipe</h2>
                    <div class="header-buttons">
                        <button id="addUserBtn" class="btn btn-primary">
                            <span class="icon">üë§‚ûï</span>
                            Cr√©er un compte
                        </button>
                    </div>
                </div>

                <!-- Sous-navigation √©quipe -->
                <div class="team-nav">
                    <button id="teamListTab" class="team-nav-btn active">üë• √âquipe</button>
                    <button id="profilesTab" class="team-nav-btn">üë§ Profils</button>
                    <button id="schedulesTab" class="team-nav-btn">üìÖ Plannings</button>
                </div>

                <!-- Vue Liste d'√©quipe -->
                <div id="teamListView" class="team-view active">
                    <div class="team-stats">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">üë®‚Äçüíº</div>
                                <div class="stat-info">
                                    <div class="stat-number" id="managerCount">0</div>
                                    <div class="stat-label">Managers</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üë•</div>
                                <div class="stat-info">
                                    <div class="stat-number" id="employeeCount">0</div>
                                    <div class="stat-label">Employ√©s</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="team-list">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nom complet</th>
                                        <th>Email</th>
                                        <th>T√©l√©phone</th>
                                        <th>R√¥le</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="teamTableBody">
                                    <tr>
                                        <td colspan="6" class="loading-message">Chargement de l'√©quipe...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Vue Profils -->
                <div id="profilesView" class="team-view">
                    <div class="profiles-header">
                        <h3>üìã Gestion des Profils</h3>
                        <p>G√©rez les informations d√©taill√©es de vos employ√©s et managers</p>
                    </div>

                    <div class="profiles-grid" id="profilesGrid">
                        <div class="loading-message">Chargement des profils...</div>
                    </div>
                </div>

                <!-- Vue Plannings -->
                <div id="schedulesView" class="team-view">
                    <div class="schedules-header">
                        <h3>üìÖ Gestion des Plannings</h3>
                        <div class="schedule-controls">
                            <button id="addScheduleBtn" class="btn btn-secondary">
                                ‚ûï Nouveau planning
                            </button>
                            <select id="scheduleWeekSelect" class="form-control">
                                <option value="current">Cette semaine</option>
                                <option value="next">Semaine prochaine</option>
                            </select>
                        </div>
                    </div>

                    <div class="schedules-content" id="schedulesContent">
                        <div class="loading-message">Chargement des plannings...</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal pour ajouter/modifier un plat -->
    <div id="menuItemModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 id="modalTitle">Ajouter un plat</h3>
            <form id="menuItemForm">
                <div class="form-group">
                    <label for="itemName">Nom du plat:</label>
                    <input type="text" id="itemName" required>
                </div>
                <div class="form-group">
                    <label for="itemDescription">Description:</label>
                    <textarea id="itemDescription"></textarea>
                </div>
                <div class="form-group">
                    <label for="itemPrice">Prix (‚Ç¨):</label>
                    <input type="number" id="itemPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="itemCategory">Cat√©gorie:</label>
                    <select id="itemCategory" required>
                        <option value="aperitif">üç∏ Ap√©ritifs</option>
                        <option value="entree">ü•ó Entr√©es</option>
                        <option value="plat">üçΩÔ∏è Plats</option>
                        <option value="dessert">üç∞ Desserts</option>
                        <option value="boisson_froide">üßä Boissons froides</option>
                        <option value="boisson_chaude">‚òï Boissons chaudes</option>
                        <option value="boisson_alcoolise">üç∑ Boissons alcoolis√©es</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="itemStock">Stock initial:</label>
                    <input type="number" id="itemStock" min="0">
                </div>
                <div class="form-group">
                    <label for="itemImage">URL de l'image (facultatif):</label>
                    <input type="text" id="itemImage" placeholder="https://exemple.com/image.jpg">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Sauvegarder</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour ajouter une table -->
    <div id="tableModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Ajouter une table</h3>
            <form id="tableForm">
                <div class="form-group">
                    <label for="tableNumber">Num√©ro de table:</label>
                    <input type="number" id="tableNumber" min="1" required>
                </div>
                <div class="form-group">
                    <label for="tableRoom">Salle:</label>
                    <select id="tableRoom" required>
                        <option value="">-- Choisir une salle --</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Cr√©er la table</button>
                    <button type="button" class="btn btn-secondary" onclick="closeTableModal()">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour ajouter un ingr√©dient -->
    <div id="ingredientModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Ajouter un Ingr√©dient</h3>
            <form id="ingredientForm">
                <div class="form-group">
                    <label for="ingredientName">Nom de l'ingr√©dient:</label>
                    <input type="text" id="ingredientName" required placeholder="Ex: Tomates, Fromage, Viande hach√©e...">
                </div>
                <div class="form-group">
                    <label for="ingredientUnit">Unit√© de mesure:</label>
                    <select id="ingredientUnit" required>
                        <option value="">-- Choisir une unit√© --</option>
                        <option value="kg">Kilogrammes (kg)</option>
                        <option value="g">Grammes (g)</option>
                        <option value="L">Litres (L)</option>
                        <option value="mL">Millilitres (mL)</option>
                        <option value="unit√©">Unit√©s</option>
                        <option value="bo√Æte">Bo√Ætes</option>
                        <option value="sachet">Sachets</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ingredientStock">Stock initial:</label>
                    <input type="number" id="ingredientStock" min="0" step="0.1" value="0" required>
                </div>
                <div class="form-group">
                    <label for="ingredientMinStock">Seuil d'alerte:</label>
                    <input type="number" id="ingredientMinStock" min="0" step="0.1" value="0" placeholder="Stock minimum avant alerte">
                </div>
                <div class="form-group">
                    <label for="ingredientCost">Co√ªt par unit√© (‚Ç¨) - optionnel:</label>
                    <input type="number" id="ingredientCost" min="0" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="ingredientSupplier">Fournisseur - optionnel:</label>
                    <input type="text" id="ingredientSupplier" placeholder="Nom du fournisseur">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Ajouter l'Ingr√©dient</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeIngredientModal()">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour ajouter une salle -->
    <div id="roomModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Ajouter une salle</h3>
            <form id="roomForm">
                <div class="form-group">
                    <label for="roomName">Nom de la salle:</label>
                    <input type="text" id="roomName" required placeholder="Ex: Salle principale, Terrasse, VIP...">
                </div>
                <div class="form-group">
                    <label for="roomWidth">Largeur (en pixels):</label>
                    <input type="number" id="roomWidth" min="300" max="800" value="600" required>
                </div>
                <div class="form-group">
                    <label for="roomHeight">Hauteur (en pixels):</label>
                    <input type="number" id="roomHeight" min="200" max="600" value="400" required>
                </div>
                <div class="form-group">
                    <label for="roomColor">Couleur de fond:</label>
                    <select id="roomColor">
                        <option value="#f8f9fa">Gris clair</option>
                        <option value="#e3f2fd">Bleu clair</option>
                        <option value="#f3e5f5">Violet clair</option>
                        <option value="#e8f5e8">Vert clair</option>
                        <option value="#fff3e0">Orange clair</option>
                        <option value="#ffebee">Rose clair</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Cr√©er la salle</button>
                    <button type="button" class="btn btn-secondary" onclick="closeRoomModal()">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour √©diter une salle -->
    <div id="editRoomModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Modifier la salle</h3>
            <form id="editRoomForm">
                <input type="hidden" id="editRoomId">
                <div class="form-group">
                    <label for="editRoomName">Nom de la salle:</label>
                    <input type="text" id="editRoomName" required placeholder="Ex: Salle principale, Terrasse, VIP...">
                </div>
                <div class="form-group">
                    <label for="editRoomWidth">Largeur (en pixels):</label>
                    <input type="number" id="editRoomWidth" min="300" max="1200" required>
                    <small>Attention: R√©duire la taille peut d√©placer les tables existantes</small>
                </div>
                <div class="form-group">
                    <label for="editRoomHeight">Hauteur (en pixels):</label>
                    <input type="number" id="editRoomHeight" min="200" max="800" required>
                    <small>Attention: R√©duire la taille peut d√©placer les tables existantes</small>
                </div>
                <div class="form-group">
                    <label for="editRoomColor">Couleur de fond:</label>
                    <select id="editRoomColor">
                        <option value="#f8f9fa">Gris clair</option>
                        <option value="#e3f2fd">Bleu clair</option>
                        <option value="#f3e5f5">Violet clair</option>
                        <option value="#e8f5e8">Vert clair</option>
                        <option value="#fff3e0">Orange clair</option>
                        <option value="#ffebee">Rose clair</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Sauvegarder les modifications</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeEditRoomModal()">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour cr√©er un nouveau restaurant -->
    <div id="newRestaurantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üè™ Cr√©er un nouveau restaurant</h3>
                <span class="close">&times;</span>
            </div>
            <form id="newRestaurantForm">
                <div class="form-group">
                    <label for="newRestaurantName">Nom du restaurant *</label>
                    <input type="text" id="newRestaurantName" required placeholder="Ex: Restaurant Le D√©lice">
                </div>

                <div class="form-group">
                    <label for="newRestaurantEmail">Email de contact</label>
                    <input type="email" id="newRestaurantEmail" placeholder="contact@restaurant.com">
                </div>

                <div class="form-group">
                    <label for="newRestaurantPhone">T√©l√©phone</label>
                    <input type="tel" id="newRestaurantPhone" placeholder="01 23 45 67 89">
                </div>

                <div class="form-group">
                    <label for="newRestaurantAddress">Adresse compl√®te</label>
                    <textarea id="newRestaurantAddress" rows="3" placeholder="123 Rue de la Gastronomie, 75001 Paris"></textarea>
                </div>

                <div class="form-group">
                    <label for="newRestaurantDescription">Description (optionnelle)</label>
                    <textarea id="newRestaurantDescription" rows="2" placeholder="Cuisine traditionnelle fran√ßaise dans un cadre chaleureux..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelNewRestaurant">Annuler</button>
                    <button type="submit" class="btn btn-primary">Cr√©er le restaurant</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour cr√©er un nouveau utilisateur -->
    <div id="newUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üë§ Cr√©er un nouvel utilisateur</h3>
                <span class="close">&times;</span>
            </div>
            <form id="newUserForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="newUserFirstName">Pr√©nom *</label>
                        <input type="text" id="newUserFirstName" required placeholder="Jean">
                    </div>
                    <div class="form-group">
                        <label for="newUserLastName">Nom *</label>
                        <input type="text" id="newUserLastName" required placeholder="Dupont">
                    </div>
                </div>

                <div class="form-group">
                    <label for="newUserEmail">Email *</label>
                    <input type="email" id="newUserEmail" required placeholder="jean.dupont@restaurant.com">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="newUserPassword">Mot de passe temporaire *</label>
                        <input type="password" id="newUserPassword" required placeholder="Minimum 6 caract√®res">
                        <small class="form-help">L'utilisateur devra changer ce mot de passe lors de sa premi√®re connexion</small>
                    </div>
                    <div class="form-group">
                        <label for="newUserRole">R√¥le *</label>
                        <select id="newUserRole" required>
                            <option value="">S√©lectionnez un r√¥le</option>
                            <option value="MANAGER">Manager</option>
                            <option value="EMPLOYE">Employ√©</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="newUserPhone">T√©l√©phone</label>
                    <input type="tel" id="newUserPhone" placeholder="01 23 45 67 89">
                </div>

                <div class="form-group">
                    <label for="newUserNotes">Notes (optionnelles)</label>
                    <textarea id="newUserNotes" rows="2" placeholder="Informations compl√©mentaires sur l'utilisateur..."></textarea>
                </div>

                <div class="permission-info">
                    <h4>üìã Permissions selon le r√¥le</h4>
                    <div class="role-permissions">
                        <div class="permission-card">
                            <strong>Manager</strong>
                            <ul>
                                <li>Gestion du menu (modification)</li>
                                <li>Gestion des tables et commandes</li>
                                <li>Consultation des plannings</li>
                                <li>Gestion des √©v√©nements</li>
                            </ul>
                        </div>
                        <div class="permission-card">
                            <strong>Employ√©</strong>
                            <ul>
                                <li>Consultation du menu</li>
                                <li>Consultation des tables</li>
                                <li>Visualisation des commandes</li>
                                <li>Consultation des plannings</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelNewUser">Annuler</button>
                    <button type="submit" class="btn btn-primary">Cr√©er l'utilisateur</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour configurer l'apparence d'une table -->
    <div id="tableAppearanceModal" class="table-appearance-modal">
        <div class="table-appearance-content">
            <div class="appearance-header">
                <h3>‚öôÔ∏è Configuration de la table</h3>
                <span class="close" onclick="app.closeTableAppearanceModal()">&times;</span>
            </div>

            <div class="appearance-section">
                <h4>üî≥ Forme de la table</h4>
                <div class="shape-options">
                    <div class="shape-option" data-shape="round">
                        <div class="shape-preview round">T</div>
                        <div>Ronde</div>
                    </div>
                    <div class="shape-option" data-shape="square">
                        <div class="shape-preview square">T</div>
                        <div>Carr√©e</div>
                    </div>
                </div>
            </div>

            <div class="appearance-section">
                <h4>üìè Taille de la table</h4>
                <div class="size-options">
                    <div class="size-option" data-size="small">
                        <div class="size-preview small">S</div>
                        <div>Petite</div>
                    </div>
                    <div class="size-option" data-size="medium">
                        <div class="size-preview medium">M</div>
                        <div>Moyenne</div>
                    </div>
                    <div class="size-option" data-size="large">
                        <div class="size-preview large">L</div>
                        <div>Grande</div>
                    </div>
                </div>
            </div>

            <div class="appearance-actions">
                <button class="btn btn-secondary" onclick="app.closeTableAppearanceModal()">Annuler</button>
                <button class="btn btn-primary" onclick="app.saveTableAppearance()">Sauvegarder</button>
            </div>
        </div>
    </div>

    <script src="/js/auth.js?v=2.0"></script>
    <script src="/js/app.js?v=2.0"></script>
</body>
</html>